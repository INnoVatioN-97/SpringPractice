# 김영한님 인프런 실전! 스프링 부트와 JPA 활용1 - 웹 애플리케이션 개발 코드 따라적어보기
---

### 요구사항 분석

![img.png](img.png)

- 기본적인 쇼핑몰

**테이블 설계**

![img_1.png](img_1.png)

**회원, 주문 상품의 관계**
- 회원: 여러 상품을 주문, 한번 주문시 여러 상품이 선택되므로 주문과 상품은 다대다.
  - 상품 - 주문의 관계를 주문상품 이라는 엔티티를 추가해 1:N, N:1 관계로 풀어냄.

**상품 분류**
- 상품은 도서, 음반, 영화로 구분되어 상품이라는 공통 속성을 사용하므로 이를 "상품" 이라는 클래스를 만들고 이를 상속하는 구조로 표현.

**회원 엔티티 분석**

![img_2.png](img_2.png)

- 회원 테이블 : 임베디드 타입으로 Address, Orders (List)를 가짐.
- 주문 테이블 : 한번 주문시 여러 상품을 주문할 수 있으므로 OrderItem 은 1:N 관계.
  - 주문은 상품을 주문한 회원과 배송정보, 주문날짜, 주문 상태(Status)를 가지고있다. 주문상태는 enum 을 사용. (ORDER, CANCEL)
- 주문상품(OrderItem) : 주문한 상품 정보와 주문금액, 수량을 가지고있다. (통상적으로 OrderLine, LineItem 으로 많이 표현)
- 상품 : 이름, 가격, 재고수량을 갖고있다. 주문시 재고 수량이 줄어듬.
- 배공 : 주문시 하나의 배송 정보를 생성. 주문 - 배송 : 1:1 관계.
- 카테고리 : 상품과 N:N 관계. parent, child 로 부모 자식 카테고리를 연결.
- 주소 : Embedded Type. 회원과 배송에서 사용.

**회원 테이블 분석**

![img_3.png](img_3.png)

---

## 알게된 점

**persistence.xml**
- Springboot 는 복잡한 설정을 자동화시켜 이전처럼 persistence.xml 같은걸 resources/META-INF 이런데다가 안만들어도 된다.

---

## 주의점


### 엔티티 설계시
**가급적 Setter 사용을 지양한다.**
- Setter 가 열려있으면 변경포인트가 많아 유지보수 극혐. 개발중엔 @Setter 를 써도, 프로덕션레벨쯤 가면 Refactoring 으로 Setter 제거

**모든 연관관계는 Lazy로 설정**
- EAGER(즉시 로딩)은 예측이 어렵고 어떤 SQL 이 실행될지 추적 어려움. 특히 JPQL 을 사용할때 N+1문제가 자주 발생. (쓸데없는 쿼리 발생 = 성능 저하)
- 즉, 실무에선 모든 연관관계는 LAZY(지연로딩)로. 연관된 엔티티를 함께 DB 에서 조회할 떈 fetch join 또는 엔티티 그래프 기능 사용.
  - **@OneToOne**, **@ManyToOne**은 기본값이 EAGER 이므로 신경써서 LAZY 로 바꾸기.